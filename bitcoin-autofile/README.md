# Bitcoin Autofile

`bitcoin-autofile` is a Rust crate that provides a non-refcounted RAII (Resource Acquisition Is Initialization) wrapper for a C `FILE*`. This utility aims to offer a safe and ergonomic interface for handling file pointers in Rust, ensuring that files are automatically closed when they go out of scope, thus preventing resource leaks.

## Overview

This crate features an `AutoFile` struct which abstracts over C-style file management. It automatically closes files upon `Drop`, providing a robust mechanism to ensure files are not left unclosed. Moreover, functions like `release` allow manual control over resource management, enabling advanced use cases where ownership of the file pointer is transferred.

- **Automatic Resource Management**: The design leverages RAII principles to facilitate automatic file closure, enhancing safety and reducing potential errors during file manipulation.
- **Custom Serialization/Deserialization**: The `AutoFile` struct supports custom serialization and deserialization operations `shl` and `shr`, compatible with C++ bit-level operations, ensuring seamless data exchange.
- **Direct File Operations**: Includes methods like `fclose`, `read_ptr`, `write_ptr`, and more, for low-level file operations with the convenience of Rust's safety guarantees.

## Safety Considerations

Special attention is required when working with raw file pointers. Constructors and methods interact with raw pointers under the assumption they are valid and uniquely borrowed. Operations may result in undefined behavior if these preconditions are violated.

## Usage

```rust
use bitcoin_autofile::AutoFile;

// Example instantiation
let file_ptr: *mut libc::FILE = /* obtain FILE* via C or FFI */;
let mut auto_file = AutoFile::new(file_ptr, /* type */, /* version */);

// Write data to file
let data = "Hello, Bitcoin!".as_bytes();
auto_file.write(data).expect("Write failed");

// Read data from file
let mut buffer = vec![0; data.len()];
auto_file.read(&mut buffer).expect("Read failed");

// AutoFile automatically closes when going out of scope or manually
auto_file.fclose();
```

Please note that while this file was generated by an AI model and may not be 100% accurate, it is designed to be highly useful for understanding and utilizing the `bitcoin-autofile` crate efficiently.