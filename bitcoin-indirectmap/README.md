# Bitcoin IndirectMap

The **bitcoin-indirectmap** crate provides a specialized map data structure where keys are handled as `Arc<K>` pointers, but comparisons are made by the dereferenced value of `K`. This allows for efficient memory usage and ensures that keys respect a total ordering based on their dereferenced values, an essential feature in cryptographic contexts like Bitcoin.

## Overview

This crate implements a flexible and efficient mapping structure that accommodates frequent, dynamic usage patterns while providing robust iterator interfaces. It allows for an effective encapsulation where the concrete map implementation remains abstracted from the client using the `HasIndirectMapTypes` trait.

### Key Features
- **Total Ordering Requirement:** Ensures that type `K` must implement the `Ord` trait, vital for cryptographic reliability.
- **Dynamic Memory Calculation:** Functions like `dynamic_usage` and `incremental_dynamic_usage` afford users insights into memory footprint, a critical parameter for resource-bound applications.
- **Safe Concurrency:** Using atomic reference counting, the structure is optimized for concurrent environments where key immutability within the map is paramount.
- **Efficient Insertion and Access:** Offers mutable and immutable access patterns through convenience methods (`get`, `find`, `get_mut`, `find_mut`, etc.), facilitating ease of custom manipulations.

## Usage Example

```rust
use bitcoin_indirectmap::{IndirectMap};
use std::sync::Arc;

fn main() {
    let mut map: IndirectMap<u32, String> = IndirectMap::default();
    let key1 = Arc::new(1);
    let key2 = Arc::new(2);

    map.insert(Arc::clone(&key1), "Value for key1".to_string());
    map.insert(Arc::clone(&key2), "Value for key2".to_string());

    assert_eq!(map.find(&1).map(|(_, v)| v.clone()), Some("Value for key1".to_string()));
    assert!(map.erase(&1));
}
```

In the given example, we create an `IndirectMap` and perform typical operations like insertion, lookup, and removal while ensuring that operations respect internal invariants.

## Advanced Concepts
The IndirectMap leverages modern Rust features such as traits and generic programming to maintain high performance and correctness in cryptographic operations. By requiring that keys not mutate in an order-breaking manner, the structure melds high-level safety guarantees with competitive performance optimizations.

Note: This README was generated by an AI model and may not be 100% accurate; however, it should provide a comprehensive understanding of the crate's functionality.