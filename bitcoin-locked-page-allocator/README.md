# Bitcoin Locked Page Allocator

Bitcoin Locked Page Allocator is a Rust crate providing OS-dependent allocation and deallocation of locked and pinned memory pages. It offers a secure memory allocation mechanism by ensuring memory pages remain resident, minimizing the risk of sensitive data being swapped to disk. This functionality is critical for cryptographic applications where keying material must not be exposed to unauthorized access.

## Overview

The crate defines a trait `LockedPageAllocator` that abstracts memory page allocation and deallocation across different operating systems. Concrete implementations include `Win32LockedPageAllocator` for Windows and `PosixLockedPageAllocator` for Unix-like systems, ensuring cross-platform support.

## Features

- **OS-Specific Implementations**: Provides optimized memory handling for both Windows and Unix-like systems.
- **Memory Locking**: Utilizes `VirtualLock` on Windows and `mlock` on Unix to pin pages in RAM.
- **Page Size Determination**: Automatically detects system page size to ensure memory alignment.
- **Allocation and Deallocation**: Interfaces expose allocation and deallocation methods, with an attempt to keep memory from being swapped out.

## Usage

After including the crate in your `Cargo.toml`:

```toml
[dependencies]
bitcoin-locked-page-allocator = "0.1.18"
```

Implement the `LockedPageAllocator` trait for your custom allocator or use the provided implementations for specific operating systems:

```rust
use bitcoin_locked_page_allocator::{LockedPageAllocator, AllocateLocked, FreeLocked, GetLimit};

#[cfg(windows)]
let mut allocator = Win32LockedPageAllocator::default();

#[cfg(unix)]
let mut allocator = PosixLockedPageAllocator::default();
```

## Example

Allocate and lock a memory page:

```rust
fn secure_allocate_example() {
    let mut allocator = PosixLockedPageAllocator::default();
    let mut locking_success = false;
    let address = allocator.allocate_locked(1024, &mut locking_success);
    if locking_success {
        println!("Memory locked successfully.");
        allocator.free_locked(address, 1024);
    } else {
        println!("Failed to lock memory.");
    }
}
```

## Note

Memory locking mechanisms like `mlock` and `VirtualLock` are best-effort and depend on OS-specific constraints such as per-process limits and system configurations.

---

*Generated by an AI model, accuracy not guaranteed.*