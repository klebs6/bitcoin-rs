# bitcoinleveldb-posixwfile

`bitcoinleveldb-posixwfile` is a Rust library providing a robust implementation for handling writable files on POSIX-compliant operating systems. This crate specifically focuses on ensuring data durability and resilience against power failures during file operations, which is crucial for systems like Bitcoin's LevelDB that rely on data integrity.

## Features

- **POSIX Compliant File Operations**: Ensures that file descriptors' data caches are flushed to durable media, capable of withstanding power failures.
- **Concurrency and Buffering**: Efficient data buffering and asynchronous write commands allow for optimized file I/O operations.
- **Platform-Specific Durability Guarantees**: Employs platform-specific syscalls (such as `F_FULLFSYNC` on macOS) to fulfill durability guarantees beyond the standard POSIX requirements.
- **Error Handling for Diverse Filesystems**: Robust handling of specific errors like ignoring `EINVAL` during directory syncs, accommodating diverse filesystem behavior.
- **Configurability for Manifest Files**: Special operations to ensure new files referred by manifest are safely committed.

## Example Usage

```rust
use bitcoinleveldb_posixwfile::PosixWritableFile;

fn main() {
   let filename = "example.log".to_string();
   let fd = 42; // File descriptor, acquired from opening the file via OS calls
   let mut file = PosixWritableFile::new(filename, fd);

   // Append data to the file
   let data = Slice::from("Some important data");
   let status = file.append(&data);
   if status.is_ok() {
       println!("Data successfully appended!");
   }

   // Ensure all data is synced
   file.sync();

   // Close the file when done
   file.close();
}
```

*Please note: Some code utilities require calling unsafe functions and understanding syscalls, aligned with the POSIX standards.*

## Module Overview

### `PosixWritableFile`

- **Methods**:
  - `new`: Instantiates a new writable file with a filename and file descriptor.
  - `append`: Buffers data for writing and writes if the buffer capacity is exceeded.
  - `sync`: Writes out any in-buffer data, ensuring it and related directories are synced.
  - `close`: Flushes data and closes the file descriptor.
  - `flush_buffer`, `write_unbuffered`: Internal methods for handling buffered and unbuffered writes.

## License

This crate is licensed under the MIT License.

---
This README.md file was generated by an AI model and may not be 100% accurate; however, it should be pretty good.